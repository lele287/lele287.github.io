var g=Object.defineProperty;var D=(r,t,e)=>t in r?g(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var h=(r,t,e)=>(D(r,typeof t!="symbol"?t+"":t,e),e);import"./modulepreload-polyfill-3cfb730f.js";class y{constructor(t){h(this,"addDownMove",t=>{var e=(t.offsetX-this.offsetX)/this.scale,a=(t.offsetY-this.offsetY)/this.scale;const s=[e,a];switch(this.drawData.type){case"rect":s.push(0,0);break;case"line":s.push(e,a);break}this.push({...this.drawData,data:s}),this.downData=this.data[this.data.length-1],this.El.addEventListener("mousemove",this.moveDrawFunc,!1)});h(this,"moveDrawFunc",t=>{var e=(t.offsetX-this.offsetX)/this.scale,a=(t.offsetY-this.offsetY)/this.scale;switch(this.drawData.type){case"rect":this.downData.data[2]=e-this.downData.data[0],this.downData.data[3]=a-this.downData.data[1];break;case"line":this.downData.data[2]=e,this.downData.data[3]=a;break}this.render()});h(this,"addMouseWhell",()=>{document.addEventListener("mousewheel",this.scrollFunc,{passive:!1})});h(this,"removeMouseWhell",()=>{document.removeEventListener("mousewheel",this.scrollFunc,{passive:!1})});h(this,"scrollFunc",t=>{if(t.preventDefault(),t.wheelDelta){var e=t.offsetX-this.offsetX,a=t.offsetY-this.offsetY,s=e/this.scale*this.step,i=a/this.scale*this.step;t.wheelDelta>0?(this.offsetX-=this.scale>=this.maxScale?0:s,this.offsetY-=this.scale>=this.maxScale?0:i,this.scale+=this.step):(this.offsetX+=this.scale<=this.minScale?0:s,this.offsetY+=this.scale<=this.minScale?0:i,this.scale-=this.step),this.scale=Math.min(this.maxScale,Math.max(this.scale,this.minScale)),this.render()}});h(this,"addMouseMove",t=>{this.targetX=t.offsetX,this.targetY=t.offsetY,this.mousedownOriginX=this.offsetX,this.mousedownOriginY=this.offsetY;var e=(this.targetX-this.offsetX)/this.scale,a=(this.targetY-this.offsetY)/this.scale;this.activeShape=null,this.data.forEach(s=>{switch(s.type){case"rect":this.isInnerRect(...s.data,e,a)&&(this.activeShape=s);break;case"circle":this.isInnerCircle(s.x,s.y,s.r,e,a)&&(this.activeShape=s);break;case"line":var i=s.data.length/2-1,o=!1;for(let n=0;n<i;n++){let l=n*2;if(o=this.isInnerPath(s.data[l],s.data[l+1],s.data[l+2],s.data[l+3],e,a,s.lineWidth||1),o){this.activeShape=s;break}}}}),this.activeShape?(this.wrapDom.style.cursor="all-scroll",this.shapedOldX=null,this.shapedOldY=null,this.El.addEventListener("mousemove",this.moveShapeFunc,!1)):(this.wrapDom.style.cursor="grabbing",this.El.addEventListener("mousemove",this.moveCanvasFunc,!1))});h(this,"removeMouseEvent",()=>{this.wrapDom.style.cursor="",this.removeMouseDown(),this.removeMouseMove()});h(this,"removeMouseMove",()=>{this.El.removeEventListener("mousemove",this.moveCanvasFunc,!1),this.El.removeEventListener("mousemove",this.moveShapeFunc,!1),this.El.removeEventListener("mousemove",this.moveDrawFunc,!1)});h(this,"removeMouseDown",()=>{this.El.removeEventListener("mousedown",this.addMouseMove,!1),this.El.removeEventListener("mousedown",this.addDownMove,!1)});h(this,"moveCanvasFunc",t=>{var e=this.El.width/2,a=this.El.height/2,s=this.mousedownOriginX+(t.offsetX-this.targetX),i=this.mousedownOriginY+(t.offsetY-this.targetY);this.offsetX=Math.abs(s)>e?this.offsetX:s,this.offsetY=Math.abs(i)>a?this.offsetY:i,this.render()});h(this,"moveShapeFunc",t=>{var e=t.offsetX-(this.shapedOldX||this.targetX),a=t.offsetY-(this.shapedOldY||this.targetY);switch(e/=this.scale,a/=this.scale,this.activeShape.type){case"rect":let o=this.activeShape.data[0],n=this.activeShape.data[1],l=this.activeShape.data[2],f=this.activeShape.data[3];this.activeShape.data=[o+e,n+a,l,f];break;case"circle":this.activeShape.x+=e,this.activeShape.y+=a;break;case"line":var s=this.activeShape,i=s.data.length/2;for(let c=0;c<i;c++){let v=c*2;s.data[v]+=e,s.data[v+1]+=a}}this.shapedOldX=t.offsetX,this.shapedOldY=t.offsetY,this.render()});this.wrapDom=t.el;var e=getComputedStyle(t.el);this.width=parseInt(e.width,10),this.height=parseInt(e.height,10),this.El=document.createElement("canvas"),this.El.height=this.height,this.El.width=this.width,this.ctx=this.El.getContext("2d"),t.el.appendChild(this.El),this.data=[],this.scale=1,this.maxScale=3,this.minScale=1,this.step=.1,this.offsetX=0,this.offsetY=0,this.addScaleFunc(),this.addDragFunc()}addScaleFunc(){this.El.addEventListener("mouseenter",this.addMouseWhell),this.El.addEventListener("mouseleave",this.removeMouseWhell)}addDragFunc(){document.addEventListener("mouseup",this.removeMouseMove)}setDrawType(t){switch(this.drawData=t,this.removeMouseEvent(),t.type){case"rect":this.El.addEventListener("mousedown",this.addDownMove);break;case"line":this.El.addEventListener("mousedown",this.addDownMove);break;case"shift":this.El.addEventListener("mousedown",this.addMouseMove);break}}isInnerRect(t,e,a,s,i,o){return t<=i&&e<=o&&t+a>=i&&e+s>=o}isInnerCircle(t,e,a,s,i){return Math.pow(t-s,2)+Math.pow(e-i,2)<=Math.pow(a,2)}isInnerPath(t,e,a,s,i,o,n){var l=Math.pow(t-i,2)+Math.pow(e-o,2),f=Math.sqrt(l,2),c=Math.pow(a-i,2)+Math.pow(s-o,2),v=Math.sqrt(c,2),p=Math.pow(a-t,2)+Math.pow(s-e,2),u=Math.sqrt(p,2),m=n/2,E=(l-c+p)/(2*u),S=Math.sqrt(l-Math.pow(E,2),2),M=Math.sqrt(Math.pow(u,2)+Math.pow(m,2));return S<=m&&f<=M&&v<=M}drawCircle(t){this.ctx.beginPath(),this.ctx.fillStyle=t.fillStyle,this.ctx.arc(t.x,t.y,t.r,0,2*Math.PI),this.ctx.fill()}drawLine(t){var e=t.data.concat(),a=a||this.ctx;a.beginPath(),a.moveTo(e.shift(),e.shift()),a.lineWidth=t.lineWidth||1;do a.lineTo(e.shift(),e.shift());while(e.length);a.stroke()}drawRect(t){this.ctx.beginPath(),this.ctx.fillStyle=t.fillStyle,this.ctx.fillRect(...t.data)}render(){this.El.width=this.width,this.data.forEach(t=>{this.draw(t)})}draw(t){switch(this.ctx.setTransform(this.scale,0,0,this.scale,this.offsetX,this.offsetY),t.type){case"line":this.drawLine(t);break;case"rect":this.drawRect(t);break;case"circle":this.drawCircle(t);break}}push(t){this.data.push(t),this.draw(t)}}var d=new y({el:document.getElementById("chart-wrap")});d.push({type:"circle",fillStyle:"pink",x:400,y:300,r:50});d.push({type:"line",lineWidth:4,data:[100,90,200,90]});d.push({type:"rect",fillStyle:"#0f00ff",data:[350,400,100,100]});const w=r=>{r==="rect"?d.setDrawType({type:"rect",fillStyle:"orange"}):r==="line"?d.setDrawType({type:"line",lineWidth:4}):r==="shift"&&d.setDrawType({type:"shift"})};document.getElementById("rect").onclick=()=>{w("rect")};document.getElementById("line").onclick=()=>{w("line")};document.getElementById("shift").onclick=()=>{w("shift")};
